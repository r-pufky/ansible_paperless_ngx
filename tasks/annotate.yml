---
# yamllint disable rule:line-length
###############################################################################
# Annotate User Configuration.
###############################################################################
# Paperless does not consistently apply variable conventions to config file,
# using a combination of absent, none, 'None', '' (empty string), 'unset', and
# 'blank' values to explicitly represent omitted states (and in some cases
# where a empty string means something different than None), including Boolean
# values. Order does not matter.
#
# Some values are rendered as pure JSON strings (which must be tested against
# raw values as emtpy JSON strings may contained escaped characters).
#
# Decision: Use defined variable interpretation guidance below for rendering.
#     Adjust and explicitly comment variables that do not follow role-specific
#     interpretation for default values:
#     * Boolean - Lowercased string.
#     * '' - render as empty string.
#     * None,none - Variable removed from rendering. Use keep=false to
#           explicitly remove from render.
#     * Absent,Unset,Blank - Variable removed from rendering for specific
#           values. Use keep=false to explicitly remove from render.
#     * JSON - RAW json data structure string.
#
# Docker-specific options are NOT implemented.
#
# Only valid database options can exist for the specified DB engine, otherwise
# paperless fails to start. Generate additional APT package dependencies for
# OCR supported languages.
#
# Use r_pufky.data.v3 data annotations to enforce consistency and validation
# checks.
#
# Generates:
#   _paperless_ngx: dict - Role runtime specific config.
#   _paperless_ngx_map: list of dict - Annotated config map.
#   _paperless_ngx_order: list of str - Config section order.
#
# Reference:
# * https://docs.paperless-ngx.com/setup/#bare_metal
# * https://docs.ansible.com/ansible/latest/dev_guide/developing_program_flow_modules.html#argument-spec
# * https://github.com/ansible/ansible/issues/77159

- name: 'Annotate | DEPRECATED VARIABLES IN USE ⚠'
  when: >
    paperless_ngx_cfg_trash_dir is defined or
    paperless_webhooks_allow_internal_requests is defined
  ansible.builtin.fail:
    msg: |
      ╭───────────────────────────────────────────────────────────────────╮
      │                                                                   │
      │                   DEPRECATED VARIABLES IN USE.                    │
      │                                                                   │
      ├───────────────────────────────────────────────────────────────────╯
      │ Refer to defaults and update variables:
      │
      │ paperless_ngx_cfg_trash_dir -> paperless_ngx_cfg_empty_trash_dir
      │ paperless_webhooks_allow_internal_requests -> paperless_srv_webhooks_allow_internal_requests

- name: 'Annotate | sanitize & annotate service defaults'
  ansible.builtin.set_fact:  # noqa jinja[spacing] readability.
    _paperless_ngx_srv_version: "{{ {} | r_pufky.data.v3(
        raw=paperless_ngx_srv_version,
        default=paperless_ngx_role_validate_version,
        _major_version=(
          paperless_ngx_srv_version[1:].split('.')[:2] | join('.')
        ),
        hint='str',
        order=1
        )
      }}"
    _paperless_ngx_srv_fatal_version_enable: "{{ {} | r_pufky.data.v3(
        raw=paperless_ngx_srv_fatal_version_enable,
        default=true,
        hint='bool',
        order=2
        )
      }}"
    _paperless_ngx_srv_redis_enable: "{{ {} | r_pufky.data.v3(
        raw=paperless_ngx_srv_redis_enable,
        default=true,
        hint='bool',
        order=3
        )
      }}"
    _paperless_ngx_srv_nltk_data: "{{ {} | r_pufky.data.v3(
        raw=paperless_ngx_srv_nltk_data,
        default=paperless_ngx_role_nltk_data,
        _packages=paperless_ngx_srv_nltk_data | join(' '),
        hint='list of str',
        order=4
        )
      }}"
    _paperless_ngx_srv_jbig2enc_version: "{{ {} | r_pufky.data.v3(
        raw=paperless_ngx_srv_jbig2enc_version,
        default=paperless_ngx_role_jbig2enc_version,
        hint='str',
        order=5
        )
      }}"
    _paperless_ngx_srv_ghostscript_version: "{{ {} | r_pufky.data.v3(
        raw=paperless_ngx_srv_ghostscript_version,
        default=paperless_ngx_role_ghostscript_version,
        _release_tag=(
          'gs' ~ paperless_ngx_srv_ghostscript_version |
          replace('.', '') | replace('-', '')
        ),
        hint='str',
        order=6
        )
      }}"
    _paperless_ngx_srv_certs_path: "{{ {} | r_pufky.data.v3(
        raw=paperless_ngx_srv_certs_path,
        _src=paperless_ngx_srv_certs_path | regex_replace('\\/$', '') ~ '/',
        _dest=paperless_ngx_role_repo_extract_dir ~ '/certs',
        hint='str',
        order=7
        )
      }}"
    _paperless_ngx_srv_delete_old_versions_enable: "{{ {} | r_pufky.data.v3(
        raw=paperless_ngx_srv_delete_old_versions_enable,
        default=true,
        hint='bool',
        order=8
        )
      }}"
    _paperless_ngx_srv_force_overwrite: "{{ {} | r_pufky.data.v3(
        raw=paperless_ngx_srv_force_overwrite,
        default=false,
        hint='bool',
        order=9
        )
      }}"
    _paperless_ngx_srv_restart_daily_enable: "{{ {} | r_pufky.data.v3(
        raw=paperless_ngx_srv_restart_daily_enable,
        default=false,
        hint='bool',
        order=10
        )
      }}"
    _paperless_ngx_srv_cache_lifetime: "{{ {} | r_pufky.data.v3(
        raw=paperless_ngx_srv_cache_lifetime,
        data=paperless_ngx_srv_cache_lifetime ~ 'm',
        default=30,
        hint='int',
        order=11
        )
      }}"
    _paperless_ngx_srv_force_config_only_enable: "{{ {} | r_pufky.data.v3(
        raw=paperless_ngx_srv_force_config_only_enable,
        default=false,
        hint='bool',
        order=12
        )
      }}"
    _paperless_ngx_srv_log_level: "{{ {} | r_pufky.data.v3(
        raw=paperless_ngx_srv_log_level | upper,
        default='INFO',
        hint='str',
        order=13
        )
      }}"
    _paperless_ngx_srv_address: "{{ {} | r_pufky.data.v3(
        raw=paperless_ngx_srv_address,
        default='0.0.0.0',
        hint='str',
        order=14
        )
      }}"
    _paperless_ngx_srv_port: "{{ {} | r_pufky.data.v3(
        raw=paperless_ngx_srv_port,
        default=8000,
        hint='int',
        order=15
        )
      }}"
    _paperless_ngx_srv_webserver_workers: "{{ {} | r_pufky.data.v3(
        raw=paperless_ngx_srv_webserver_workers,
        default=1,
        hint='int',
        order=16
        )
      }}"
    _paperless_ngx_srv_user: "{{ {} | r_pufky.data.v3(
        raw=paperless_ngx_srv_user,
        default='paperless',
        _uid='',
        hint='str',
        order=17
        )
      }}"
    _paperless_ngx_srv_group: "{{ {} | r_pufky.data.v3(
        raw=paperless_ngx_srv_group,
        default='paperless',
        _gid='',
        hint='str',
        order=18
        )
      }}"
    _paperless_ngx_srv_user_data_manage_enable: "{{ {} | r_pufky.data.v3(
        raw=paperless_ngx_srv_user_data_manage_enable,
        default=false,
        hint='bool',
        order=19
        )
      }}"
    _paperless_ngx_srv_create_user: "{{ {} | r_pufky.data.v3(
        raw=paperless_ngx_srv_create_user,
        default=true,
        hint='bool',
        order=20
        )
      }}"
    _paperless_ngx_srv_media_folders: "{{ {} | r_pufky.data.v3(
        raw=paperless_ngx_srv_media_folders,
        default=['/data/consume', '/data/data', '/data/media'],
        hint='list of str',
        order=21
        )
      }}"
    _paperless_ngx_srv_media_perms_folder: "{{ {} | r_pufky.data.v3(
        raw=paperless_ngx_srv_media_perms_folder,
        default='0750',
        hint='str',
        order=22
        )
      }}"
    _paperless_ngx_srv_media_set_perms_file_enable: "{{ {} | r_pufky.data.v3(
        raw=paperless_ngx_srv_media_set_perms_file_enable,
        default=false,
        hint='bool',
        order=23
        )
      }}"
    _paperless_ngx_srv_media_perms_file: "{{ {} | r_pufky.data.v3(
        raw=paperless_ngx_srv_media_perms_file,
        default='0640',
        hint='str',
        order=24
        )
      }}"

- name: 'Annotate | sanitize & annotate config defaults'
  ansible.builtin.set_fact:  # noqa jinja[spacing] readability.
    _paperless_ngx_cfg_debug: "{{ {} | r_pufky.data.v3(
        section='Debug',
        key='PAPERLESS_DEBUG',
        raw=paperless_ngx_cfg_debug,
        default=false,
        hint='bool',
        order=1
        )
      }}"
    _paperless_ngx_cfg_redis: "{{ {} | r_pufky.data.v3(
        section='Required Services',
        key='PAPERLESS_REDIS',
        raw=paperless_ngx_cfg_redis,
        default='redis://localhost:6379',
        hint='str',
        order=1
        )
      }}"
    _paperless_ngx_cfg_redis_prefix: "{{ {} | r_pufky.data.v3(
        section='Required Services',
        key='PAPERLESS_REDIS_PREFIX',
        raw=paperless_ngx_cfg_redis_prefix,
        default='',
        hint='str',
        added='1.17.0',
        order=2
        )
      }}"
    _paperless_ngx_cfg_dbhost: "{{ {} | r_pufky.data.v3(
        section='Required Services',
        key='PAPERLESS_DBHOST',
        raw=paperless_ngx_cfg_dbhost,
        data=paperless_ngx_cfg_dbhost,
        default='localhost',
        keep=false if paperless_ngx_cfg_dbengine == 'sqlite' else true,
        hint='str',
        order=3
        )
      }}"
    _paperless_ngx_cfg_dbengine: "{{ {} | r_pufky.data.v3(
        section='Required Services',
        key='PAPERLESS_DBENGINE',
        raw=paperless_ngx_cfg_dbengine,
        default='postgresql',
        keep=false if paperless_ngx_cfg_dbengine == 'sqlite' else true,
        hint='str',
        order=4
        )
      }}"
    _paperless_ngx_cfg_dbport: "{{ {} | r_pufky.data.v3(
        section='Required Services',
        key='PAPERLESS_DBPORT',
        raw=paperless_ngx_cfg_dbport,
        default=5432,
        keep=false if paperless_ngx_cfg_dbengine == 'sqlite' else true,
        hint='int',
        order=5
        )
      }}"
    _paperless_ngx_cfg_dbname: "{{ {} | r_pufky.data.v3(
        section='Required Services',
        key='PAPERLESS_DBNAME',
        raw=paperless_ngx_cfg_dbname,
        default='paperless',
        keep=false if paperless_ngx_cfg_dbengine == 'sqlite' else true,
        hint='str',
        order=6
        )
      }}"
    _paperless_ngx_cfg_dbuser: "{{ {} | r_pufky.data.v3(
        section='Required Services',
        key='PAPERLESS_DBUSER',
        raw=paperless_ngx_cfg_dbuser,
        default='paperless',
        keep=false if paperless_ngx_cfg_dbengine == 'sqlite' else true,
        hint='str',
        order=7
        )
      }}"
    _paperless_ngx_cfg_dbpass: "{{ {} | r_pufky.data.v3(
        section='Required Services',
        key='PAPERLESS_DBPASS',
        raw=paperless_ngx_cfg_dbpass,
        default='paperless',
        keep=false if paperless_ngx_cfg_dbengine == 'sqlite' else true,
        hint='str',
        sensitive=true,
        order=8
        )
      }}"
    _paperless_ngx_cfg_dbsslmode: "{{ {} | r_pufky.data.v3(
        section='Required Services',
        key='PAPERLESS_DBSSLMODE',
        raw=paperless_ngx_cfg_dbsslmode,
        default='prefer',
        keep=false if paperless_ngx_cfg_dbengine == 'sqlite' else true,
        hint='str',
        order=9
        )
      }}"
    _paperless_ngx_cfg_dbsslrootcert: "{{ {} | r_pufky.data.v3(
        section='Required Services',
        key='PAPERLESS_DBSSLROOTCERT',
        raw=paperless_ngx_cfg_dbsslrootcert,
        default='',
        keep=false if paperless_ngx_cfg_dbsslrootcert == '' else true,
        hint='str',
        added='1.14.0',
        sensitive=true,
        order=10
        )
      }}"
    _paperless_ngx_cfg_dbsslcert: "{{ {} | r_pufky.data.v3(
        section='Required Services',
        key='PAPERLESS_DBSSLCERT',
        raw=paperless_ngx_cfg_dbsslcert,
        default='',
        keep=false if paperless_ngx_cfg_dbsslcert == '' else true,
        hint='str',
        added='1.14.0',
        sensitive=true,
        order=11
        )
      }}"
    _paperless_ngx_cfg_dbsslkey: "{{ {} | r_pufky.data.v3(
        section='Required Services',
        key='PAPERLESS_DBSSLKEY',
        raw=paperless_ngx_cfg_dbsslkey,
        default='',
        keep=false if paperless_ngx_cfg_dbsslkey == '' else true,
        hint='str',
        added='1.14.0',
        sensitive=true,
        order=12
        )
      }}"
    _paperless_ngx_cfg_db_timeout: "{{ {} | r_pufky.data.v3(
        section='Required Services',
        key='PAPERLESS_DB_TIMEOUT',
        raw=paperless_ngx_cfg_db_timeout,
        default=0,
        keep=false if paperless_ngx_cfg_db_timeout == -1 else true,
        hint='int',
        order=13
        )
      }}"
    _paperless_ngx_cfg_db_poolsize: "{{ {} | r_pufky.data.v3(
        section='Required Services',
        key='PAPERLESS_DB_POOLSIZE',
        raw=paperless_ngx_cfg_db_poolsize,
        default=0,
        keep=false if paperless_ngx_cfg_db_poolsize == 0 else true,
        hint='int',
        added='2.18.0',
        order=14
        )
      }}"
    _paperless_ngx_cfg_db_read_cache_enabled: "{{ {} | r_pufky.data.v3(
        section='Required Services',
        key='PAPERLESS_DB_READ_CACHE_ENABLED',
        raw=paperless_ngx_cfg_db_read_cache_enabled,
        default=false,
        hint='bool',
        added='2.18.0',
        order=15
        )
      }}"
    _paperless_ngx_cfg_read_cache_ttl: "{{ {} | r_pufky.data.v3(
        section='Required Services',
        key='PAPERLESS_READ_CACHE_TTL',
        raw=paperless_ngx_cfg_read_cache_ttl,
        default=3600,
        hint='int',
        added='2.18.0',
        order=16
        )
      }}"
    _paperless_ngx_cfg_read_cache_redis_url: "{{ {} | r_pufky.data.v3(
        section='Required Services',
        key='PAPERLESS_READ_CACHE_REDIS_URL',
        raw=paperless_ngx_cfg_read_cache_redis_url,
        default='',
        keep=false,
        hint='str',
        added='2.18.0',
        comment=(
          'Discard default setting.' ~
          'https://github.com/paperless-ngx/paperless-ngx/discussions/11178'
        ),
        order=17
        )
      }}"
    _paperless_ngx_cfg_tika_enabled: "{{ {} | r_pufky.data.v3(
        section='Optional Services (Tika settings)',
        key='PAPERLESS_TIKA_ENABLED',
        raw=paperless_ngx_cfg_tika_enabled,
        default=false,
        hint='bool',
        order=1
        )
      }}"
    _paperless_ngx_cfg_tika_endpoint: "{{ {} | r_pufky.data.v3(
        section='Optional Services (Tika settings)',
        key='PAPERLESS_TIKA_ENDPOINT',
        raw=paperless_ngx_cfg_tika_endpoint,
        default='http://localhost:9998',
        hint='str',
        order=2
        )
      }}"
    _paperless_ngx_cfg_tika_gotenberg_endpoint: "{{ {} | r_pufky.data.v3(
        section='Optional Services (Tika settings)',
        key='PAPERLESS_TIKA_GOTENBERG_ENDPOINT',
        raw=paperless_ngx_cfg_tika_gotenberg_endpoint,
        default='http://localhost:3000',
        hint='str',
        order=3
        )
      }}"
    _paperless_ngx_cfg_email_parse_default_layout: "{{ {} | r_pufky.data.v3(
        section='Email Parsing',
        key='PAPERLESS_EMAIL_PARSE_DEFAULT_LAYOUT',
        raw=paperless_ngx_cfg_email_parse_default_layout,
        default=2,
        hint='int',
        added='2.15.0',
        order=1
        )
      }}"
    _paperless_ngx_cfg_consumption_dir: "{{ {} | r_pufky.data.v3(
        section='Paths and Folders',
        key='PAPERLESS_CONSUMPTION_DIR',
        raw=paperless_ngx_cfg_consumption_dir,
        default='/data/consume',
        _dest=(
          paperless_ngx_cfg_consumption_dir | regex_replace('\\/$', '') ~ '/'
        ),
        hint='str',
        order=1
        )
      }}"
    _paperless_ngx_cfg_data_dir: "{{ {} | r_pufky.data.v3(
        section='Paths and Folders',
        key='PAPERLESS_DATA_DIR',
        raw=paperless_ngx_cfg_data_dir,
        default='/data/data',
        hint='str',
        order=2
        )
      }}"
    _paperless_ngx_cfg_trash_dir: "{{ {} | r_pufky.data.v3(
        section='Paths and Folders',
        key='PAPERLESS_TRASH_DIR',
        raw=paperless_ngx_cfg_empty_trash_dir,
        default='',
        hint='str',
        deprecated=true,
        comment='Replaced by PAPERLESS_EMPTY_TRASH_DIR.',
        order=3
        )
      }}"
    _paperless_ngx_cfg_empty_trash_dir: "{{ {} | r_pufky.data.v3(
        section='Paths and Folders',
        key='PAPERLESS_EMPTY_TRASH_DIR',
        raw=paperless_ngx_cfg_empty_trash_dir,
        default='',
        hint='str',
        added='2.10.0',
        order=3
        )
      }}"
    _paperless_ngx_cfg_media_root: "{{ {} | r_pufky.data.v3(
        section='Paths and Folders',
        key='PAPERLESS_MEDIA_ROOT',
        raw=paperless_ngx_cfg_media_root,
        default='/data/media',
        hint='str',
        order=4
        )
      }}"
    _paperless_ngx_cfg_staticdir: "{{ {} | r_pufky.data.v3(
        section='Paths and Folders',
        key='PAPERLESS_STATICDIR',
        raw=paperless_ngx_cfg_staticdir,
        default='../static',
        hint='str',
        order=5
        )
      }}"
    _paperless_ngx_cfg_filename_format: "{{ {} | r_pufky.data.v3(
        section='Paths and Folders',
        key='PAPERLESS_FILENAME_FORMAT',
        raw=paperless_ngx_cfg_filename_format,
        default=paperless_ngx_role_unsafe_empty,
        keep=false if paperless_ngx_cfg_filename_format == '' else true,
        hint='str',
        order=6
        )
      }}"
    _paperless_ngx_cfg_filename_format_remove_none: "{{ {} | r_pufky.data.v3(
        section='Paths and Folders',
        key='PAPERLESS_FILENAME_FORMAT_REMOVE_NONE',
        raw=paperless_ngx_cfg_filename_format_remove_none,
        default=false,
        hint='bool',
        order=7
        )
      }}"
    _paperless_ngx_cfg_logging_dir: "{{ {} | r_pufky.data.v3(
        section='Paths and Folders',
        key='PAPERLESS_LOGGING_DIR',
        raw=paperless_ngx_cfg_logging_dir,
        default=paperless_ngx_cfg_data_dir ~ '/log',
        hint='str',
        order=8
        )
      }}"
    _paperless_ngx_cfg_nltk_dir: "{{ {} | r_pufky.data.v3(
        section='Paths and Folders',
        key='PAPERLESS_NLTK_DIR',
        raw=paperless_ngx_cfg_nltk_dir,
        default='/usr/share/nltk_data',
        hint='str',
        added='1.11.0',
        order=9
        )
      }}"
    _paperless_ngx_cfg_model_file: "{{ {} | r_pufky.data.v3(
        section='Paths and Folders',
        key='PAPERLESS_MODEL_FILE',
        raw=paperless_ngx_cfg_model_file,
        default=paperless_ngx_cfg_data_dir ~ '/classification_model.pickle',
        hint='str',
        added='2.9.0',
        order=10
        )
      }}"
    _paperless_ngx_cfg_logrotate_max_size: "{{ {} | r_pufky.data.v3(
        section='Logging',
        key='PAPERLESS_LOGROTATE_MAX_SIZE',
        raw=paperless_ngx_cfg_logrotate_max_size,
        default=1,
        hint='int',
        order=1
        )
      }}"
    _paperless_ngx_cfg_logrotate_max_backups: "{{ {} | r_pufky.data.v3(
        section='Logging',
        key='PAPERLESS_LOGROTATE_MAX_BACKUPS',
        raw=paperless_ngx_cfg_logrotate_max_backups,
        default=20,
        hint='int',
        order=2
        )
      }}"
    _paperless_ngx_cfg_secret_key: "{{ {} | r_pufky.data.v3(
        section='Hosting and Security',
        key='PAPERLESS_SECRET_KEY',
        raw=paperless_ngx_cfg_secret_key,
        default=(
          lookup('ansible.builtin.password',
                 '/dev/null',
                 chars=['ascii_lowercase', 'ascii_uppercase', 'digits'],
                 length=50)
        ),
        hint='str',
        sensitive=true,
        order=1
        )
      }}"
    _paperless_ngx_cfg_url: "{{ {} | r_pufky.data.v3(
        section='Hosting and Security',
        key='PAPERLESS_URL',
        raw=paperless_ngx_cfg_url,
        default='',
        hint='str',
        order=2
        )
      }}"
    _paperless_ngx_cfg_csrf_trusted_origins: "{{ {} | r_pufky.data.v3(
        section='Hosting and Security',
        key='PAPERLESS_CSRF_TRUSTED_ORIGINS',
        raw=paperless_ngx_cfg_csrf_trusted_origins,
        data=paperless_ngx_cfg_csrf_trusted_origins | join(','),
        default=[],
        hint='list of str',
        order=3
        )
      }}"
    _paperless_ngx_cfg_allowed_hosts: "{{ {} | r_pufky.data.v3(
        section='Hosting and Security',
        key='PAPERLESS_ALLOWED_HOSTS',
        raw=paperless_ngx_cfg_allowed_hosts,
        data=paperless_ngx_cfg_allowed_hosts | join(','),
        default=['*'],
        hint='list of str',
        order=4
        )
      }}"
    _paperless_ngx_cfg_cors_allowed_hosts: "{{ {} | r_pufky.data.v3(
        section='Hosting and Security',
        key='PAPERLESS_CORS_ALLOWED_HOSTS',
        raw=paperless_ngx_cfg_cors_allowed_hosts,
        data=paperless_ngx_cfg_cors_allowed_hosts | join(','),
        default=['http://localhost:8000'],
        hint='list of str',
        order=5
        )
      }}"
    _paperless_ngx_cfg_trusted_proxies: "{{ {} | r_pufky.data.v3(
        section='Hosting and Security',
        key='PAPERLESS_TRUSTED_PROXIES',
        raw=paperless_ngx_cfg_trusted_proxies,
        data=paperless_ngx_cfg_trusted_proxies | join(','),
        default=[],
        hint='list of str',
        added='1.14.0',
        order=6
        )
      }}"
    _paperless_ngx_cfg_force_script_name: "{{ {} | r_pufky.data.v3(
        section='Hosting and Security',
        key='PAPERLESS_FORCE_SCRIPT_NAME',
        raw=paperless_ngx_cfg_force_script_name,
        default='',
        keep=false if paperless_ngx_cfg_force_script_name == '' else true,
        hint='str',
        order=7
        )
      }}"
    _paperless_ngx_cfg_static_url: "{{ {} | r_pufky.data.v3(
        section='Hosting and Security',
        key='PAPERLESS_STATIC_URL',
        raw=paperless_ngx_cfg_static_url,
        default='/static/',
        hint='str',
        order=8
        )
      }}"
    _paperless_ngx_cfg_auto_login_username: "{{ {} | r_pufky.data.v3(
        section='Hosting and Security',
        key='PAPERLESS_AUTO_LOGIN_USERNAME',
        raw=paperless_ngx_cfg_auto_login_username,
        default='',
        keep=false if paperless_ngx_cfg_auto_login_username == '' else true,
        hint='str',
        order=9
        )
      }}"
    _paperless_ngx_cfg_admin_user: "{{ {} | r_pufky.data.v3(
        section='Hosting and Security',
        key='PAPERLESS_ADMIN_USER',
        raw=paperless_ngx_cfg_admin_user,
        default='paperless',
        hint='str',
        order=10
        )
      }}"
    _paperless_ngx_cfg_admin_mail: "{{ {} | r_pufky.data.v3(
        section='Hosting and Security',
        key='PAPERLESS_ADMIN_MAIL',
        raw=paperless_ngx_cfg_admin_mail,
        default='root@localhost',
        hint='str',
        sensitive=true,
        order=11
        )
      }}"
    _paperless_ngx_cfg_admin_password: "{{ {} | r_pufky.data.v3(
        section='Hosting and Security',
        key='PAPERLESS_ADMIN_PASSWORD',
        raw=paperless_ngx_cfg_admin_password,
        default='paperless',
        hint='str',
        sensitive=true,
        order=12
        )
      }}"
    _paperless_ngx_cfg_cookie_prefix: "{{ {} | r_pufky.data.v3(
        section='Hosting and Security',
        key='PAPERLESS_COOKIE_PREFIX',
        raw=paperless_ngx_cfg_cookie_prefix,
        default='',
        hint='str',
        order=13
        )
      }}"
    _paperless_ngx_cfg_enable_http_remote_user: "{{ {} | r_pufky.data.v3(
        section='Hosting and Security',
        key='PAPERLESS_ENABLE_HTTP_REMOTE_USER',
        raw=paperless_ngx_cfg_enable_http_remote_user,
        default=false,
        hint='bool',
        order=14
        )
      }}"
    _paperless_ngx_cfg_enable_http_remote_user_api: "{{ {} | r_pufky.data.v3(
        section='Hosting and Security',
        key='PAPERLESS_ENABLE_HTTP_REMOTE_USER_API',
        raw=paperless_ngx_cfg_enable_http_remote_user_api,
        default=false,
        hint='bool',
        added='2.5.0',
        order=15
        )
      }}"
    _paperless_ngx_cfg_http_remote_user_header_name: "{{ {} | r_pufky.data.v3(
        section='Hosting and Security',
        key='PAPERLESS_HTTP_REMOTE_USER_HEADER_NAME',
        raw=paperless_ngx_cfg_http_remote_user_header_name,
        default='HTTP_REMOTE_USER',
        hint='str',
        order=16
        )
      }}"
    _paperless_ngx_cfg_logout_redirect_url: "{{ {} | r_pufky.data.v3(
        section='Hosting and Security',
        key='PAPERLESS_LOGOUT_REDIRECT_URL',
        raw=paperless_ngx_cfg_logout_redirect_url,
        default='',
        keep=false if paperless_ngx_cfg_logout_redirect_url == '' else true,
        hint='str',
        order=17
        )
      }}"
    _paperless_ngx_cfg_use_x_forward_host: "{{ {} | r_pufky.data.v3(
        section='Hosting and Security',
        key='PAPERLESS_USE_X_FORWARD_HOST',
        raw=paperless_ngx_cfg_use_x_forward_host,
        default=false,
        hint='bool',
        added='1.14.0',
        order=18
        )
      }}"
    _paperless_ngx_cfg_use_x_forward_port: "{{ {} | r_pufky.data.v3(
        section='Hosting and Security',
        key='PAPERLESS_USE_X_FORWARD_PORT',
        raw=paperless_ngx_cfg_use_x_forward_port,
        default=false,
        hint='bool',
        added='1.14.0',
        order=19
        )
      }}"
    _paperless_ngx_cfg_proxy_ssl_header: "{{ {} | r_pufky.data.v3(
        section='Hosting and Security',
        key='PAPERLESS_PROXY_SSL_HEADER',
        raw=paperless_ngx_cfg_proxy_ssl_header,
        data=(
          [paperless_ngx_cfg_proxy_ssl_header.header,
           paperless_ngx_cfg_proxy_ssl_header.raw] | to_json
          if paperless_ngx_cfg_proxy_ssl_header | length > 0 else
          ''
        ),
        default={},
        keep=false if paperless_ngx_cfg_proxy_ssl_header == {} else true,
        hint='json',
        added='1.14.0',
        comment='JSON dict.',
        order=20
        )
      }}"
    _paperless_ngx_cfg_email_certificate_location: "{{ {} | r_pufky.data.v3(
        section='Hosting and Security',
        key='PAPERLESS_EMAIL_CERTIFICATE_LOCATION',
        raw=paperless_ngx_cfg_email_certificate_location,
        default='',
        keep=(
          false if paperless_ngx_cfg_email_certificate_location == '' else true
        ),
        hint='str',
        added='2.0.0',
        order=21
        )
      }}"
    _paperless_ngx_cfg_account_allow_signups: "{{ {} | r_pufky.data.v3(
        section='Authentication and SSO',
        key='PAPERLESS_ACCOUNT_ALLOW_SIGNUPS',
        raw=paperless_ngx_cfg_account_allow_signups,
        default=false,
        hint='bool',
        added='2.5.0',
        order=1
        )
      }}"
    _paperless_ngx_cfg_account_default_groups: "{{ {} | r_pufky.data.v3(
        section='Authentication and SSO',
        key='PAPERLESS_ACCOUNT_DEFAULT_GROUPS',
        raw=paperless_ngx_cfg_account_default_groups,
        data=paperless_ngx_cfg_account_default_groups | join(','),
        default=[],
        keep=(
          false if paperless_ngx_cfg_account_default_groups == [] else true
        ),
        hint='list of str',
        added='2.15.0',
        order=2
        )
      }}"
    _paperless_ngx_cfg_socialaccount_providers: "{{ {} | r_pufky.data.v3(
        section='Authentication and SSO',
        key='PAPERLESS_SOCIALACCOUNT_PROVIDERS',
        raw=paperless_ngx_cfg_socialaccount_providers,
        data=paperless_ngx_cfg_socialaccount_providers | to_json,
        default='',
        keep=(
          false if paperless_ngx_cfg_socialaccount_providers == '' else true
        ),
        hint='json',
        added='2.5.0',
        comment='JSON str.',
        order=3
        )
      }}"
    _paperless_ngx_cfg_social_auto_signup: "{{ {} | r_pufky.data.v3(
        section='Authentication and SSO',
        key='PAPERLESS_SOCIAL_AUTO_SIGNUP',
        raw=paperless_ngx_cfg_social_auto_signup,
        default=false,
        hint='bool',
        added='2.5.0',
        order=4
        )
      }}"
    _paperless_ngx_cfg_socialaccount_allow_signups: "{{ {} | r_pufky.data.v3(
        section='Authentication and SSO',
        key='PAPERLESS_SOCIALACCOUNT_ALLOW_SIGNUPS',
        raw=paperless_ngx_cfg_socialaccount_allow_signups,
        default=true,
        hint='bool',
        added='2.5.0',
        order=5
        )
      }}"
    _paperless_ngx_cfg_social_account_sync_groups: "{{ {} | r_pufky.data.v3(
        section='Authentication and SSO',
        key='PAPERLESS_SOCIAL_ACCOUNT_SYNC_GROUPS',
        raw=paperless_ngx_cfg_social_account_sync_groups,
        default=false,
        hint='bool',
        added='2.15.0',
        order=6
        )
      }}"
    _paperless_ngx_cfg_social_account_default_groups: "{{ {} | r_pufky.data.v3(
        section='Authentication and SSO',
        key='PAPERLESS_SOCIAL_ACCOUNT_DEFAULT_GROUPS',
        raw=paperless_ngx_cfg_social_account_default_groups,
        data=paperless_ngx_cfg_social_account_default_groups | join(','),
        default=[],
        keep=(
          false
          if paperless_ngx_cfg_social_account_default_groups == [] else
          true
        ),
        hint='list of str',
        added='2.15.0',
        order=7
        )
      }}"
    _paperless_ngx_cfg_account_default_http_protocol: "{{ {} | r_pufky.data.v3(
        section='Authentication and SSO',
        key='PAPERLESS_ACCOUNT_DEFAULT_HTTP_PROTOCOL',
        raw=paperless_ngx_cfg_account_default_http_protocol,
        default='https',
        hint='str',
        added='2.5.0',
        order=8
        )
      }}"
    _paperless_ngx_cfg_account_email_verification: "{{ {} | r_pufky.data.v3(
        section='Authentication and SSO',
        key='PAPERLESS_ACCOUNT_EMAIL_VERIFICATION',
        raw=paperless_ngx_cfg_account_email_verification,
        default='none',
        hint='str',
        added='2.6.0',
        order=9
        )
      }}"
    _paperless_ngx_cfg_account_email_unknown_accounts: "{{
      {} | r_pufky.data.v3(
        section='Authentication and SSO',
        key='PAPERLESS_ACCOUNT_EMAIL_UNKNOWN_ACCOUNTS',
        raw=paperless_ngx_cfg_account_email_unknown_accounts,
        default=true,
        hint='bool',
        added='2.16.0',
        order=10
        )
      }}"
    _paperless_ngx_cfg_disable_regular_login: "{{ {} | r_pufky.data.v3(
        section='Authentication and SSO',
        key='PAPERLESS_DISABLE_REGULAR_LOGIN',
        raw=paperless_ngx_cfg_disable_regular_login,
        default=false,
        hint='bool',
        added='2.6.0',
        order=11
        )
      }}"
    _paperless_ngx_cfg_paperless_redirect_login_to_sso: "{{
      {} | r_pufky.data.v3(
        section='Authentication and SSO',
        key='PAPERLESS_REDIRECT_LOGIN_TO_SSO',
        raw=paperless_ngx_cfg_paperless_redirect_login_to_sso,
        default=false,
        hint='bool',
        added='2.12.0',
        order=12
        )
      }}"
    _paperless_ngx_cfg_paperless_account_session_remember: "{{
      {} | r_pufky.data.v3(
        section='Authentication and SSO',
        key='PAPERLESS_ACCOUNT_SESSION_REMEMBER',
        raw=paperless_ngx_cfg_paperless_account_session_remember,
        default=true,
        hint='bool',
        added='2.7.0',
        order=13
        )
      }}"
    _paperless_ngx_cfg_paperless_session_cookie_age: "{{ {} | r_pufky.data.v3(
        section='Authentication and SSO',
        key='PAPERLESS_SESSION_COOKIE_AGE',
        raw=paperless_ngx_cfg_paperless_session_cookie_age,
        default=1209600,
        hint='int',
        added='2.12.0',
        order=14
        )
      }}"
    _paperless_ngx_cfg_ocr_language: '{{ {} | r_pufky.data.v3(
        section="OCR Settings",
        key="PAPERLESS_OCR_LANGUAGE",
        raw=paperless_ngx_cfg_ocr_language,
        data=paperless_ngx_cfg_ocr_language | join("+"),
        default=["eng"],
        _packages=(
          paperless_ngx_cfg_ocr_language |
          map("regex_replace", "^(.*)$", "tesseract-ocr-\1") | list
        ),
        keep=false if paperless_ngx_cfg_ocr_language == [] else true,
        hint="list of str",
        order=1
        )
      }}'
    _paperless_ngx_cfg_ocr_mode: "{{ {} | r_pufky.data.v3(
        section='OCR Settings',
        key='PAPERLESS_OCR_MODE',
        raw=paperless_ngx_cfg_ocr_mode | lower,
        default='skip',
        hint='str',
        order=2
        )
      }}"
    _paperless_ngx_cfg_ocr_skip_archive_file: "{{ {} | r_pufky.data.v3(
        section='OCR Settings',
        key='PAPERLESS_OCR_SKIP_ARCHIVE_FILE',
        raw=paperless_ngx_cfg_ocr_skip_archive_file | lower,
        default='never',
        hint='str',
        added='1.14.0',
        order=3
        )
      }}"
    _paperless_ngx_cfg_ocr_clean: "{{ {} | r_pufky.data.v3(
        section='OCR Settings',
        key='PAPERLESS_OCR_CLEAN',
        raw=paperless_ngx_cfg_ocr_clean | lower,
        default='clean',
        hint='str',
        order=4
        )
      }}"
    _paperless_ngx_cfg_ocr_deskew: "{{ {} | r_pufky.data.v3(
        section='OCR Settings',
        key='PAPERLESS_OCR_DESKEW',
        raw=paperless_ngx_cfg_ocr_deskew,
        default=true,
        hint='bool',
        order=5
        )
      }}"
    _paperless_ngx_cfg_ocr_rotate_pages: "{{ {} | r_pufky.data.v3(
        section='OCR Settings',
        key='PAPERLESS_OCR_ROTATE_PAGES',
        raw=paperless_ngx_cfg_ocr_rotate_pages,
        default=true,
        hint='bool',
        order=6
        )
      }}"
    _paperless_ngx_cfg_ocr_rotate_pages_threshold: "{{ {} | r_pufky.data.v3(
        section='OCR Settings',
        key='PAPERLESS_OCR_ROTATE_PAGES_THRESHOLD',
        raw=paperless_ngx_cfg_ocr_rotate_pages_threshold | lower,
        default=12,
        hint='int',
        order=7
        )
      }}"
    _paperless_ngx_cfg_ocr_output_type: "{{ {} | r_pufky.data.v3(
        section='OCR Settings',
        key='PAPERLESS_OCR_OUTPUT_TYPE',
        raw=paperless_ngx_cfg_ocr_output_type | lower,
        default='pdfa',
        hint='str',
        order=8
        )
      }}"
    _paperless_ngx_cfg_ocr_pages: "{{ {} | r_pufky.data.v3(
        section='OCR Settings',
        key='PAPERLESS_OCR_PAGES',
        raw=paperless_ngx_cfg_ocr_pages,
        default=0,
        keep=false if paperless_ngx_cfg_ocr_pages == 0 else true,
        hint='int',
        order=9
        )
      }}"
    _paperless_ngx_cfg_ocr_image_dpi: "{{ {} | r_pufky.data.v3(
        section='OCR Settings',
        key='PAPERLESS_OCR_IMAGE_DPI',
        raw=paperless_ngx_cfg_ocr_image_dpi,
        default=600,
        keep=false if paperless_ngx_cfg_ocr_image_dpi == 0 else true,
        hint='int',
        order=10
        )
      }}"
    _paperless_ngx_cfg_ocr_max_image_pixels: "{{ {} | r_pufky.data.v3(
        section='OCR Settings',
        key='PAPERLESS_OCR_MAX_IMAGE_PIXELS',
        raw=paperless_ngx_cfg_ocr_max_image_pixels,
        default=89478485,
        keep=false if paperless_ngx_cfg_ocr_max_image_pixels == -1 else true,
        hint='int',
        order=11
        )
      }}"
    _paperless_ngx_cfg_ocr_color_conversion_strategy: "{{ {} | r_pufky.data.v3(
        section='OCR Settings',
        key='PAPERLESS_OCR_COLOR_CONVERSION_STRATEGY',
        raw=paperless_ngx_cfg_ocr_color_conversion_strategy,
        default='RGB',
        hint='str',
        added='2.1.0',
        order=12
        )
      }}"
    _paperless_ngx_cfg_ocr_user_args: "{{ {} | r_pufky.data.v3(
        section='OCR Settings',
        key='PAPERLESS_OCR_USER_ARGS',
        raw=paperless_ngx_cfg_ocr_user_args,
        data=paperless_ngx_cfg_ocr_user_args | to_json,
        default={'optimize': 1, 'jbig2_lossy': false},
        hint='json',
        comment='JSON dict.',
        order=13
        )
      }}"
    _paperless_ngx_cfg_task_workers: "{{ {} | r_pufky.data.v3(
        section='Software Tweaks',
        key='PAPERLESS_TASK_WORKERS',
        raw=paperless_ngx_cfg_task_workers,
        default=1,
        hint='int',
        order=1
        )
      }}"
    _paperless_ngx_cfg_threads_per_worker: "{{ {} | r_pufky.data.v3(
        section='Software Tweaks',
        key='PAPERLESS_THREADS_PER_WORKER',
        raw=paperless_ngx_cfg_threads_per_worker,
        default=0,
        keep=false if paperless_ngx_cfg_threads_per_worker == 0 else true,
        hint='int',
        order=2
        )
      }}"
    _paperless_ngx_cfg_worker_timeout: "{{ {} | r_pufky.data.v3(
        section='Software Tweaks',
        key='PAPERLESS_WORKER_TIMEOUT',
        raw=paperless_ngx_cfg_worker_timeout,
        default=1800,
        hint='int',
        order=3
        )
      }}"
    _paperless_ngx_cfg_time_zone: "{{ {} | r_pufky.data.v3(
        section='Software Tweaks',
        key='PAPERLESS_TIME_ZONE',
        raw=paperless_ngx_cfg_time_zone,
        default='UTC',
        hint='str',
        order=4
        )
      }}"
    _paperless_ngx_cfg_enable_nltk: "{{ {} | r_pufky.data.v3(
        section='Software Tweaks',
        key='PAPERLESS_ENABLE_NLTK',
        raw=paperless_ngx_cfg_enable_nltk,
        default=true,
        hint='bool as int',
        added='1.11.0',
        order=5
        )
      }}"
    _paperless_ngx_cfg_date_parser_languages: "{{ {} | r_pufky.data.v3(
        section='Software Tweaks',
        key='PAPERLESS_DATE_PARSER_LANGUAGES',
        raw=paperless_ngx_cfg_date_parser_languages,
        data=paperless_ngx_cfg_date_parser_languages | join('+'),
        default=[],
        hint='list of str',
        added='2.18.0',
        order=6
        )
      }}"
    _paperless_ngx_cfg_email_task_cron: "{{ {} | r_pufky.data.v3(
        section='Software Tweaks',
        key='PAPERLESS_EMAIL_TASK_CRON',
        raw=paperless_ngx_cfg_email_task_cron,
        default='*/10 * * * *',
        hint='str',
        added='1.12.0',
        order=7
        )
      }}"
    _paperless_ngx_cfg_train_task_cron: "{{ {} | r_pufky.data.v3(
        section='Software Tweaks',
        key='PAPERLESS_TRAIN_TASK_CRON',
        raw=paperless_ngx_cfg_train_task_cron,
        default='5 */1 * * *',
        hint='str',
        added='1.12.0',
        order=8
        )
      }}"
    _paperless_ngx_cfg_index_task_cron: "{{ {} | r_pufky.data.v3(
        section='Software Tweaks',
        key='PAPERLESS_INDEX_TASK_CRON',
        raw=paperless_ngx_cfg_index_task_cron,
        default='0 0 * * *',
        hint='str',
        added='1.12.0',
        order=9
        )
      }}"
    _paperless_ngx_cfg_sanity_task_cron: "{{ {} | r_pufky.data.v3(
        section='Software Tweaks',
        key='PAPERLESS_SANITY_TASK_CRON',
        raw=paperless_ngx_cfg_sanity_task_cron,
        default='30 0 * * sun',
        hint='str',
        added='1.12.0',
        order=10
        )
      }}"
    _paperless_ngx_cfg_enable_compression: "{{ {} | r_pufky.data.v3(
        section='Software Tweaks',
        key='PAPERLESS_ENABLE_COMPRESSION',
        raw=paperless_ngx_cfg_enable_compression,
        default=true,
        hint='bool as int',
        added='1.13.0',
        order=11
        )
      }}"
    _paperless_ngx_cfg_convert_memory_limit: "{{ {} | r_pufky.data.v3(
        section='Software Tweaks',
        key='PAPERLESS_CONVERT_MEMORY_LIMIT',
        raw=paperless_ngx_cfg_convert_memory_limit,
        default=0,
        hint='int',
        order=12
        )
      }}"
    _paperless_ngx_cfg_convert_tmpdir: "{{ {} | r_pufky.data.v3(
        section='Software Tweaks',
        key='PAPERLESS_CONVERT_TMPDIR',
        raw=paperless_ngx_cfg_convert_tmpdir,
        default='/tmp',
        keep=false if paperless_ngx_cfg_convert_tmpdir == '' else true,
        hint='str',
        order=13
        )
      }}"
    _paperless_ngx_cfg_paperless_apps: "{{ {} | r_pufky.data.v3(
        section='Software Tweaks',
        key='PAPERLESS_APPS',
        raw=paperless_ngx_cfg_paperless_apps,
        data=paperless_ngx_cfg_paperless_apps | join(','),
        default=[],
        keep=false if paperless_ngx_cfg_paperless_apps == [] else true,
        hint='list of str',
        added='2.5.0',
        order=14
        )
      }}"
    _paperless_ngx_cfg_max_image_pixels: "{{ {} | r_pufky.data.v3(
        section='Software Tweaks',
        key='PAPERLESS_MAX_IMAGE_PIXELS',
        raw=paperless_ngx_cfg_max_image_pixels,
        default=0,
        keep=false if paperless_ngx_cfg_max_image_pixels == -1 else true,
        hint='int',
        added='2.6.0',
        comment='Decision=Force disabled (0) instead of None (-1).',
        order=15
        )
      }}"
    _paperless_ngx_cfg_consumer_delete_duplicates: "{{ {} | r_pufky.data.v3(
        section='Document Consumption',
        key='PAPERLESS_CONSUMER_DELETE_DUPLICATES',
        raw=paperless_ngx_cfg_consumer_delete_duplicates,
        default=false,
        hint='bool',
        comment='PAPERLESS_CONSUMER_DISABLE is docker-only option. Ignore.',
        order=1
        )
      }}"
    _paperless_ngx_cfg_consumer_recursive: "{{ {} | r_pufky.data.v3(
        section='Document Consumption',
        key='PAPERLESS_CONSUMER_RECURSIVE',
        raw=paperless_ngx_cfg_consumer_recursive,
        default=false,
        hint='bool',
        order=2
        )
      }}"
    _paperless_ngx_cfg_consumer_subdirs_as_tags: "{{ {} | r_pufky.data.v3(
        section='Document Consumption',
        key='PAPERLESS_CONSUMER_SUBDIRS_AS_TAGS',
        raw=paperless_ngx_cfg_consumer_subdirs_as_tags,
        default=false,
        hint='bool',
        order=3
        )
      }}"
    _paperless_ngx_cfg_consumer_ignore_patterns: "{{ {} | r_pufky.data.v3(
        section='Document Consumption',
        key='PAPERLESS_CONSUMER_IGNORE_PATTERNS',
        raw=paperless_ngx_cfg_consumer_ignore_patterns,
        data=paperless_ngx_cfg_consumer_ignore_patterns | to_json,
        default=['.DS_Store/*', '.DS_STORE/*', '._*', '.stfolder/*',
                '.stversions/*', '.localized/*', 'desktop.ini', '@eaDir/*',
                'Thumbs.db'],
        hint='json',
        comment='JSON str.',
        order=4
        )
      }}"
    _paperless_ngx_cfg_consumer_barcode_scanner: "{{ {} | r_pufky.data.v3(
        section='Document Consumption',
        key='PAPERLESS_CONSUMER_BARCODE_SCANNER',
        raw=paperless_ngx_cfg_consumer_barcode_scanner | upper,
        default='ZXING',
        hint='str',
        added='1.14.0',
        order=5
        )
      }}"
    _paperless_ngx_cfg_pre_consume_script: "{{ {} | r_pufky.data.v3(
        section='Document Consumption',
        key='PAPERLESS_PRE_CONSUME_SCRIPT',
        raw=paperless_ngx_cfg_pre_consume_script,
        default='',
        keep=false if paperless_ngx_cfg_pre_consume_script == '' else true,
        hint='str',
        order=6
        )
      }}"
    _paperless_ngx_cfg_post_consume_script: "{{ {} | r_pufky.data.v3(
        section='Document Consumption',
        key='PAPERLESS_POST_CONSUME_SCRIPT',
        raw=paperless_ngx_cfg_post_consume_script,
        default='',
        keep=false if paperless_ngx_cfg_pre_consume_script == '' else true,
        hint='str',
        order=7
        )
      }}"
    _paperless_ngx_cfg_filename_date_order: "{{ {} | r_pufky.data.v3(
        section='Document Consumption',
        key='PAPERLESS_FILENAME_DATE_ORDER',
        raw=paperless_ngx_cfg_filename_date_order,
        default='YMD',
        keep=false if paperless_ngx_cfg_filename_date_order == '' else true,
        hint='str',
        order=8
        )
      }}"
    _paperless_ngx_cfg_number_of_suggested_dates: "{{ {} | r_pufky.data.v3(
        section='Document Consumption',
        key='PAPERLESS_NUMBER_OF_SUGGESTED_DATES',
        raw=paperless_ngx_cfg_number_of_suggested_dates,
        default=3,
        hint='int',
        order=9
        )
      }}"
    _paperless_ngx_cfg_thumbnail_font_name: "{{ {} | r_pufky.data.v3(
        section='Document Consumption',
        key='PAPERLESS_THUMBNAIL_FONT_NAME',
        raw=paperless_ngx_cfg_thumbnail_font_name,
        default='/usr/share/fonts/liberation/LiberationSerif-Regular.ttf',
        hint='str',
        order=10
        )
      }}"
    _paperless_ngx_cfg_ignore_dates: "{{ {} | r_pufky.data.v3(
        section='Document Consumption',
        key='PAPERLESS_IGNORE_DATES',
        raw=paperless_ngx_cfg_ignore_dates,
        data=paperless_ngx_cfg_ignore_dates | join(','),
        default=[],
        hint='list of str',
        order=11
        )
      }}"
    _paperless_ngx_cfg_date_order: "{{ {} | r_pufky.data.v3(
        section='Document Consumption',
        key='PAPERLESS_DATE_ORDER',
        raw=paperless_ngx_cfg_date_order,
        default='DMY',
        hint='str',
        order=12
        )
      }}"
    _paperless_ngx_cfg_enable_gpg_decryptor: "{{ {} | r_pufky.data.v3(
        section='Document Consumption',
        key='PAPERLESS_ENABLE_GPG_DECRYPTOR',
        raw=paperless_ngx_cfg_enable_gpg_decryptor,
        default=false,
        hint='bool',
        added='2.12.0',
        order=13
        )
      }}"
    _paperless_ngx_cfg_webhooks_allowed_schemes: "{{ {} | r_pufky.data.v3(
        section='Workflow Webhooks',
        key='PAPERLESS_WEBHOOKS_ALLOWED_SCHEMES',
        raw=paperless_ngx_cfg_webhooks_allowed_schemes,
        data=paperless_ngx_cfg_webhooks_allowed_schemes | join(','),
        default=['http', 'https'],
        hint='list of str',
        added='2.18.0',
        order=1
        )
      }}"
    _paperless_ngx_cfg_webhooks_allowed_ports: "{{ {} | r_pufky.data.v3(
        section='Workflow Webhooks',
        key='PAPERLESS_WEBHOOKS_ALLOWED_PORTS',
        raw=paperless_ngx_cfg_webhooks_allowed_ports,
        data=paperless_ngx_cfg_webhooks_allowed_ports | join(','),
        default=[],
        hint='list of int',
        added='2.18.0',
        order=2
        )
      }}"
    _paperless_srv_webhooks_allow_internal_requests: "{{ {} | r_pufky.data.v3(
        section='Workflow Webhooks',
        key='paperless_srv_webhooks_allow_internal_requests',
        raw=paperless_srv_webhooks_allow_internal_requests,
        default=true,
        hint='bool',
        added='2.18.0',
        order=3
        )
      }}"
    _paperless_ngx_cfg_consumer_polling: "{{ {} | r_pufky.data.v3(
        section='Polling',
        key='PAPERLESS_CONSUMER_POLLING',
        raw=paperless_ngx_cfg_consumer_polling,
        default=0,
        hint='int',
        order=1
        )
      }}"
    _paperless_ngx_cfg_consumer_polling_retry_count: "{{ {} | r_pufky.data.v3(
        section='Polling',
        key='PAPERLESS_CONSUMER_POLLING_RETRY_COUNT',
        raw=paperless_ngx_cfg_consumer_polling_retry_count,
        default=5,
        hint='int',
        order=2
        )
      }}"
    _paperless_ngx_cfg_consumer_polling_delay: "{{ {} | r_pufky.data.v3(
        section='Polling',
        key='PAPERLESS_CONSUMER_POLLING_DELAY',
        raw=paperless_ngx_cfg_consumer_polling_delay,
        default=5,
        hint='int',
        order=3
        )
      }}"
    _paperless_ngx_cfg_consumer_inotify_delay: "{{ {} | r_pufky.data.v3(
        section='Inotify',
        key='PAPERLESS_CONSUMER_INOTIFY_DELAY',
        raw=paperless_ngx_cfg_consumer_inotify_delay,
        default=0.5,
        hint='float',
        order=1
        )
      }}"
    _paperless_ngx_cfg_oauth_callback_base_url: "{{ {} | r_pufky.data.v3(
        section='Incoming Mail',
        key='PAPERLESS_OAUTH_CALLBACK_BASE_URL',
        raw=paperless_ngx_cfg_oauth_callback_base_url,
        default='',
        keep=(
          false if paperless_ngx_cfg_oauth_callback_base_url == '' else true
        ),
        hint='str',
        added='2.12.0',
        order=1
        )
      }}"
    _paperless_ngx_cfg_gmail_oauth_client_id: "{{ {} | r_pufky.data.v3(
        section='Incoming Mail',
        key='PAPERLESS_GMAIL_OAUTH_CLIENT_ID',
        raw=paperless_ngx_cfg_gmail_oauth_client_id,
        default='',
        keep=false if paperless_ngx_cfg_gmail_oauth_client_id == '' else true,
        hint='str',
        added='2.12.0',
        order=2
        )
      }}"
    _paperless_ngx_cfg_gmail_oauth_client_secret: "{{ {} | r_pufky.data.v3(
        section='Incoming Mail',
        key='PAPERLESS_GMAIL_OAUTH_CLIENT_SECRET',
        raw=paperless_ngx_cfg_gmail_oauth_client_secret,
        default='',
        keep=(
          false if paperless_ngx_cfg_gmail_oauth_client_secret == '' else true
        ),
        hint='str',
        added='2.12.0',
        sensitive=true,
        order=3
        )
      }}"
    _paperless_ngx_cfg_outlook_oauth_client_id: "{{ {} | r_pufky.data.v3(
        section='Incoming Mail',
        key='PAPERLESS_OUTLOOK_OAUTH_CLIENT_ID',
        raw=paperless_ngx_cfg_outlook_oauth_client_id,
        default='',
        keep=(
          false if paperless_ngx_cfg_outlook_oauth_client_id == '' else true
        ),
        hint='str',
        added='2.12.0',
        order=4
        )
      }}"
    _paperless_ngx_cfg_outlook_oauth_client_secret: "{{ {} | r_pufky.data.v3(
        section='Incoming Mail',
        key='PAPERLESS_OUTLOOK_OAUTH_CLIENT_SECRET',
        raw=paperless_ngx_cfg_outlook_oauth_client_secret,
        default='',
        keep=(
          false
          if paperless_ngx_cfg_outlook_oauth_client_secret == '' else
          true
        ),
        hint='str',
        added='2.12.0',
        sensitive=true,
        order=5
        )
      }}"
    _paperless_ngx_cfg_email_gnupg_home: "{{ {} | r_pufky.data.v3(
        section='Incoming Mail',
        key='PAPERLESS_EMAIL_GNUPG_HOME',
        raw=paperless_ngx_cfg_email_gnupg_home,
        default='.',
        hint='str',
        added='2.12.0',
        order=6
        )
      }}"
    _paperless_ngx_cfg_consumer_enable_barcodes: "{{ {} | r_pufky.data.v3(
        section='Barcodes',
        key='PAPERLESS_CONSUMER_ENABLE_BARCODES',
        raw=paperless_ngx_cfg_consumer_enable_barcodes,
        default=false,
        hint='bool',
        order=1
        )
      }}"
    _paperless_ngx_cfg_consumer_barcode_tiff_support: "{{ {} | r_pufky.data.v3(
        section='Barcodes',
        key='PAPERLESS_CONSUMER_BARCODE_TIFF_SUPPORT',
        raw=paperless_ngx_cfg_consumer_barcode_tiff_support,
        default=false,
        hint='bool',
        order=2
        )
      }}"
    _paperless_ngx_cfg_consumer_barcode_string: "{{ {} | r_pufky.data.v3(
        section='Barcodes',
        key='PAPERLESS_CONSUMER_BARCODE_STRING',
        raw=paperless_ngx_cfg_consumer_barcode_string,
        default='PATCHT',
        hint='str',
        order=3
        )
      }}"
    _paperless_ngx_cfg_consumer_barcode_retain_split_pages: "{{ {} | r_pufky.data.v3(
        section='Barcodes',
        key='PAPERLESS_CONSUMER_BARCODE_RETAIN_SPLIT_PAGES',
        raw=paperless_ngx_cfg_consumer_barcode_retain_split_pages,
        default=false,
        hint='bool',
        added='2.12.0',
        order=4
        )
      }}"
    _paperless_ngx_cfg_consumer_enable_asn_barcode: "{{ {} | r_pufky.data.v3(
        section='Barcodes',
        key='PAPERLESS_CONSUMER_ENABLE_ASN_BARCODE',
        raw=paperless_ngx_cfg_consumer_enable_asn_barcode,
        default=false,
        hint='bool',
        added='1.12.0',
        order=5
        )
      }}"
    _paperless_ngx_cfg_consumer_asn_barcode_prefix: "{{ {} | r_pufky.data.v3(
        section='Barcodes',
        key='PAPERLESS_CONSUMER_ASN_BARCODE_PREFIX',
        raw=paperless_ngx_cfg_consumer_asn_barcode_prefix,
        default='ASN',
        hint='str',
        added='1.12.0',
        order=6
        )
      }}"
    _paperless_ngx_cfg_consumer_barcode_upscale: "{{ {} | r_pufky.data.v3(
        section='Barcodes',
        key='PAPERLESS_CONSUMER_BARCODE_UPSCALE',
        raw=paperless_ngx_cfg_consumer_barcode_upscale,
        default=0.0,
        hint='float',
        added='1.16.0',
        order=7
        )
      }}"
    _paperless_ngx_cfg_consumer_barcode_dpi: "{{ {} | r_pufky.data.v3(
        section='Barcodes',
        key='PAPERLESS_CONSUMER_BARCODE_DPI',
        raw=paperless_ngx_cfg_consumer_barcode_dpi,
        default=300,
        hint='int',
        added='1.16.0',
        order=8
        )
      }}"
    _paperless_ngx_cfg_consumer_barcode_max_pages: "{{ {} | r_pufky.data.v3(
        section='Barcodes',
        key='PAPERLESS_CONSUMER_BARCODE_MAX_PAGES',
        raw=paperless_ngx_cfg_consumer_barcode_max_pages,
        default=0,
        hint='int',
        added='2.12.0',
        order=9
        )
      }}"
    _paperless_ngx_cfg_consumer_enable_tag_barcode: "{{ {} | r_pufky.data.v3(
        section='Barcodes',
        key='PAPERLESS_CONSUMER_ENABLE_TAG_BARCODE',
        raw=paperless_ngx_cfg_consumer_enable_tag_barcode,
        default=false,
        hint='bool',
        added='2.5.0',
        order=10
        )
      }}"
    _paperless_ngx_cfg_consumer_tag_barcode_mapping: '{{ {} | r_pufky.data.v3(
        section="Barcodes",
        key="PAPERLESS_CONSUMER_TAG_BARCODE_MAPPING",
        raw=paperless_ngx_cfg_consumer_tag_barcode_mapping,
        data=paperless_ngx_cfg_consumer_tag_barcode_mapping | to_json,
        default={"TAG:(.*)": "\\g<1>"},
        hint="json",
        comment="JSON dict.",
        order=11
        )
      }}'
    _paperless_ngx_cfg_audit_log_enabled: "{{ {} | r_pufky.data.v3(
        section='Audit Trails',
        key='PAPERLESS_AUDIT_LOG_ENABLED',
        raw=paperless_ngx_cfg_audit_log_enabled,
        default=true,
        hint='bool',
        added='2.0.0',
        order=1
        )
      }}"
    _paperless_ngx_cfg_consumer_enable_collate_double_sided: "{{
      {} | r_pufky.data.v3(
        section='Collate Double-sided Documents',
        key='PAPERLESS_CONSUMER_ENABLE_COLLATE_DOUBLE_SIDED',
        raw=paperless_ngx_cfg_consumer_enable_collate_double_sided,
        default=false,
        hint='bool',
        added='1.17.0',
        order=1
        )
      }}"
    _paperless_ngx_cfg_consumer_collate_double_sided_subdir_name: "{{
      {} | r_pufky.data.v3(
        section='Collate Double-sided Documents',
        key='PAPERLESS_CONSUMER_COLLATE_DOUBLE_SIDED_SUBDIR_NAME',
        raw=paperless_ngx_cfg_consumer_collate_double_sided_subdir_name,
        default='double-sided',
        _dest='',
        hint='str',
        added='1.17.0',
        order=2
        )
      }}"
    _paperless_ngx_cfg_consumer_collate_double_sided_tiff_support: "{{
      {} | r_pufky.data.v3(
        section='Collate Double-sided Documents',
        key='PAPERLESS_CONSUMER_COLLATE_DOUBLE_SIDED_TIFF_SUPPORT',
        raw=paperless_ngx_cfg_consumer_collate_double_sided_tiff_support,
        default=false,
        hint='bool',
        added='1.17.0',
        order=3
        )
      }}"
    _paperless_ngx_cfg_empty_trash_delay: "{{ {} | r_pufky.data.v3(
        section='Trash',
        key='PAPERLESS_EMPTY_TRASH_DELAY',
        raw=paperless_ngx_cfg_empty_trash_delay,
        default=30,
        hint='int',
        added='2.10.0',
        order=1
        )
      }}"
    _paperless_ngx_cfg_empty_trash_task_cron: "{{ {} | r_pufky.data.v3(
        section='Trash',
        key='PAPERLESS_EMPTY_TRASH_TASK_CRON',
        raw=paperless_ngx_cfg_empty_trash_task_cron,
        default='0 1 * * *',
        hint='str',
        added='2.10.0',
        order=2
        )
      }}"
    _paperless_ngx_cfg_convert_binary: "{{ {} | r_pufky.data.v3(
        section='Binaries',
        key='PAPERLESS_CONVERT_BINARY',
        raw=paperless_ngx_cfg_convert_binary,
        default='/usr/bin/convert',
        hint='str',
        order=1
        )
      }}"
    _paperless_ngx_cfg_gs_binary: "{{ {} | r_pufky.data.v3(
        section='Binaries',
        key='PAPERLESS_GS_BINARY',
        raw=paperless_ngx_cfg_gs_binary,
        default='/usr/bin/gs',
        hint='str',
        order=2
        )
      }}"
    _paperless_ngx_cfg_app_title: "{{ {} | r_pufky.data.v3(
        section='Frontend Settings',
        key='PAPERLESS_APP_TITLE',
        raw=paperless_ngx_cfg_app_title,
        default='Paperless-ngx',
        hint='str',
        added='2.4.0',
        order=1
        )
      }}"
    _paperless_ngx_cfg_app_logo: "{{ {} | r_pufky.data.v3(
        section='Frontend Settings',
        key='PAPERLESS_APP_LOGO',
        raw=paperless_ngx_cfg_app_logo,
        default='',
        keep=false if paperless_ngx_cfg_app_logo == '' else true,
        hint='str',
        added='2.4.0',
        order=2
        )
      }}"
    _paperless_ngx_cfg_enable_update_check: "{{ {} | r_pufky.data.v3(
        section='Frontend Settings',
        key='PAPERLESS_ENABLE_UPDATE_CHECK',
        raw=true,
        default=true,
        hint='bool',
        added='1.9.2',
        deprecated=true,
        comment='WebUI auto migrates if variable exists.',
        order=3
        )
      }}"
    _paperless_ngx_cfg_email_host: "{{ {} | r_pufky.data.v3(
        section='Email Sending',
        key='PAPERLESS_EMAIL_HOST',
        raw=paperless_ngx_cfg_email_host,
        default='localhost',
        hint='str',
        added='2.0.0',
        order=1
        )
      }}"
    _paperless_ngx_cfg_email_port: "{{ {} | r_pufky.data.v3(
        section='Email Sending',
        key='PAPERLESS_EMAIL_PORT',
        raw=paperless_ngx_cfg_email_port,
        default=25,
        hint='int',
        added='2.0.0',
        order=2
        )
      }}"
    _paperless_ngx_cfg_email_host_user: "{{ {} | r_pufky.data.v3(
        section='Email Sending',
        key='PAPERLESS_EMAIL_HOST_USER',
        raw=paperless_ngx_cfg_email_host_user,
        default='',
        hint='str',
        added='2.0.0',
        order=3
        )
      }}"
    _paperless_ngx_cfg_email_from: "{{ {} | r_pufky.data.v3(
        section='Email Sending',
        key='PAPERLESS_EMAIL_FROM',
        raw=(
          paperless_ngx_cfg_email_host_user
          if paperless_ngx_cfg_email_from == '' else
          paperless_ngx_cfg_email_from
        ),
        default='',
        hint='str',
        added='2.0.0',
        order=4
        )
      }}"
    _paperless_ngx_cfg_email_host_password: "{{ {} | r_pufky.data.v3(
        section='Email Sending',
        key='PAPERLESS_EMAIL_HOST_PASSWORD',
        raw=paperless_ngx_cfg_email_host_password,
        default='',
        hint='str',
        added='2.0.0',
        sensitive=true,
        order=5
        )
      }}"
    _paperless_ngx_cfg_email_use_tls: "{{ {} | r_pufky.data.v3(
        section='Email Sending',
        key='PAPERLESS_EMAIL_USE_TLS',
        raw=paperless_ngx_cfg_email_use_tls,
        default=false,
        hint='bool',
        added='2.0.0',
        order=6
        )
      }}"
    _paperless_ngx_cfg_email_use_ssl: "{{ {} | r_pufky.data.v3(
        section='Email Sending',
        key='PAPERLESS_EMAIL_USE_SSL',
        raw=paperless_ngx_cfg_email_use_ssl,
        default=false,
        hint='bool',
        added='2.0.0',
        order=7
        )
      }}"

- name: 'Annotate | update annotations with results'
  ansible.builtin.set_fact:
    _paperless_ngx_cfg_consumer_collate_double_sided_subdir_name: '{{
      _paperless_ngx_cfg_consumer_collate_double_sided_subdir_name |
      combine({"_dest":
          _paperless_ngx_cfg_consumption_dir._dest ~
          _paperless_ngx_cfg_consumer_collate_double_sided_subdir_name.raw
        })
      }}'

- name: 'Annotate | generate directories'
  ansible.builtin.set_fact:
    _paperless_ngx:
      symlink: '{{ paperless_ngx_role_repo_extract_symlink }}'
      venv_config_dir: '/var/venv'
      venv_name:
        '{{ "paperless-" ~ _paperless_ngx_srv_version._major_version }}'
      venv_dir: '{{
          "/var/venv/paperless-" ~
          _paperless_ngx_srv_version._major_version
        }}'

- name: 'Annotate | generate config map'
  ansible.builtin.set_fact:
    _paperless_ngx_map: '{{
        hostvars[inventory_hostname] | dict2items |
        selectattr("key", "match", "_paperless_ngx_cfg_*")
      }}'
    _paperless_ngx_order:
      - 'Debug'
      - 'Required Services'
      - 'Optional Services (Tika settings)'
      - 'Email Parsing'
      - 'Paths and Folders'
      - 'Logging'
      - 'Hosting and Security'
      - 'Authentication and SSO'
      - 'OCR Settings'
      - 'Software Tweaks'
      - 'Document Consumption'
      - 'Workflow Webhooks'
      - 'Polling'
      - 'Inotify'
      - 'Incoming Mail'
      - 'Barcodes'
      - 'Audit Trails'
      - 'Collate Double-sided Documents'
      - 'Trash'
      - 'Binaries'
      - 'Frontend Settings'
      - 'Email Sending'
